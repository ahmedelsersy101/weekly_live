# ุงุณู ุงูู Workflowุ ุณูุธูุฑ ูู ุชุจููุจ "Actions"
name: Deploy Flutter Web to GitHub Pages

# ุชุญุฏูุฏ ูุชู ูุชู ุชุดุบูู ุงูู Workflow
on:
  push:
    branches:
      - main  # ุณูุชู ุงูุชุดุบูู ุนูุฏ ุงูุฏูุน (Push) ุฅูู ุงููุฑุน ุงูุฑุฆูุณู (main)

# ุชุญุฏูุฏ ุงููุชุบูุฑุงุช ุงูุจูุฆูุฉ ูุงุณุชุฎุฏุงููุง ูู ุนูููุฉ ุงูุจูุงุก
env:
  # **ูุงู ุฌุฏุงู**: ูุฐุง ุงููุชุบูุฑ ูุญุฏุฏ ุงููุณุงุฑ ุงูุฃุณุงุณู (Base path) ููู assets.
  # ููุฌุจ ุฃู ูููู "/ุงุณู_ุงููุณุชูุฏุน/"
  BASE_HREF: /weekly_live/

# ุชุนุฑูู ุงููุธุงุฆู
jobs:
  build_and_deploy:
    # ุณูุชู ุชุดุบูู ูุฐู ุงููุธููุฉ ุนูู ูุธุงู ุชุดุบูู Ubuntu
    runs-on: ubuntu-latest
    
    # ๐จ **ุงูุญู ููุดููุฉ Permission denied (ุงูุฎุทุฃ 403)**
    permissions:
      contents: write
      
    steps:
      # 1. ุณุญุจ ููุฏ ุงููุดุฑูุน
      - name: Checkout Repository
        uses: actions/checkout@v4

      # 2. ุฅุนุฏุงุฏ ุจูุฆุฉ Flutter
      - name: Setup Flutter SDK
        uses: subosito/flutter-action@v2
        with:
          channel: 'stable' # ููููู ุชุญุฏูุฏ ุฅุตุฏุงุฑ ูุนูู ูุซู '3.22.0'
      
      # 3. ุฌูุจ ุงูุญุฒู (Dependencies)
      - name: Get Flutter dependencies
        run: flutter pub get

      # 4. ุจูุงุก ุชุทุจูู ุงูููุจ (Release Build)
      # ูุณุชุฎุฏู BASE_HREF ูุถูุงู ุชุญููู ุฌููุน ูููุงุช JavaScript ูุงูุฃุตูู ุจุดูู ุตุญูุญ
      - name: Build Flutter Web Release
        run: flutter build web --release --base-href ${{ env.BASE_HREF }} --no-tree-shake-icons

      # 5. ูุดุฑ ูุญุชูู ูุฌูุฏ build/web ุฅูู ูุฑุน gh-pages
      # ูุชู ุงุณุชุฎุฏุงู ุฃุฏุงุฉ peaceiris/actions-gh-pages ููุฐุง ุงูุบุฑุถ
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v4
        with:
          # ุงูู GITHUB_TOKEN ูุชู ุฅูุดุงุคู ุชููุงุฆูุงู ุจูุงุณุทุฉ GitHub ูููุญ ุตูุงุญูุฉ ุงููุดุฑ
          github_token: ${{ secrets.GITHUB_TOKEN }} 
          # ุงููุฌูุฏ ุงูุฐู ุณูุชู ูุดุฑู
          publish_dir: ./build/web
          # ุงููุฑุน ุงูุฐู ุณูุชู ุงููุดุฑ ุนููู (ูุฌุจ ุชูุนููู ูู ุฅุนุฏุงุฏุงุช Pages)
          publish_branch: gh-pages
